<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//iBATIS.com//DTD SQL Map 2.0//EN"
  "http://ibatis.apache.org/dtd/sql-map-2.dtd">

<sqlMap namespace="EP011001">
	<typeAlias alias="EP011001VO" type="kr.co.jmena.www.web.home.expayMng.Vo.EP011001VO"/>
	<typeAlias alias="HR011001VO" type="kr.co.jmena.www.web.home.personMng.Vo.HR011001VO"/>

	<resultMap id="EP011001Data" class="EP011001VO">
		<result property="PAYDATE"					column="PAYDATE"/>
		<result property="PAYSEQ"					column="PAYSEQ"/>
		<result property="SALERCD"					column="SALERCD"/>
		<result property="SALERNM"					column="SALERNM"/>
		<result property="INSACODE"					column="INSACODE"/>
		<result property="KNAME"					column="KNAME"/>
		<result property="SELLAMT"					column="SELLAMT"/>
		<result property="PAYAMT"					column="PAYAMT"/>
		<result property="TAXAMT"					column="TAXAMT"/>
		<result property="DEDUCTAMT"				column="DEDUCTAMT"/>
	
		<result property="SALEDATE"					column="SALEDATE"/>
		<result property="SALEID"					column="SALEID"	/>
		<result property="SALEGUBUN"				column="SALEGUBUN"/>
		<result property="BRANCHCODE"				column="BRANCHCODE"/>		
		<result property="MANAGENO"					column="MANAGENO"/>
		<result property="CITYCODE"					column="CITYCODE"/>
		<result property="ADDRESS"					column="ADDRESS"/>
		<result property="CONNAME"					column="CONNAME"	/>
		<result property="CONM2"					column="CONM2"/>
		<result property="CONPY"					column="CONPY"/>
		<result property="SALEAMT"					column="SALEAMT"/>
		<result property="SALEDANGA"				column="SALEDANGA"/>
		<result property="DCGUBUN"					column="DCGUBUN"/>
		<result property="DCRATE"					column="DCRATE"/>
		<result property="DCAMT"					column="DCAMT"/>
		<result property="SELLAMT"					column="SELLAMT"/>
		<result property="SUDANGRATE"				column="SUDANGRATE"/>
		<result property="ADDRATE"					column="ADDRATE"/>
		<result property="TAXGUBUN"					column="TAXGUBUN"/>
		<result property="TAXGUBUNNAME"				column="TAXGUBUNNAME"/>
		<result property="TAXINCOME"				column="TAXINCOME"/>
		<result property="TAXLOCAL"					column="TAXLOCAL"/>
		<result property="SUPPLYTAX"				column="SUPPLYTAX"/>
		<result property="REGISTERNUM"				column="REGISTERNUM"/>
		<result property="GRADE"					column="GRADE"/>
		<result property="DUTY"						column="DUTY"/>
		<result property="REMARK"					column="REMARK"/>
		
	</resultMap>
	
	<resultMap id="EP011001Datalist" class="EP011001VO">
		<result property="PAYDATE"					column="PAYDATE"/>
		<result property="PAYSEQ"					column="PAYSEQ"/>
		<result property="SALERCD"					column="SALERCD"/>
		<result property="SALERNM"					column="SALERNM"/>
		<result property="INSACODE"					column="INSACODE"/>
		<result property="KNAME"					column="KNAME"/>
		<result property="SELLAMT"					column="SELLAMT"/>
		<result property="PAYAMT"					column="PAYAMT"/>
		<result property="TAXAMT"					column="TAXAMT"/>
		<result property="DEDUCTAMT"				column="DEDUCTAMT"/>
	
		<result property="SALEDATE"					column="SALEDATE"/>
		<result property="SALEID"					column="SALEID"	/>
		<result property="SALEGUBUN"				column="SALEGUBUN"/>
		<result property="BRANCHCODE"				column="BRANCHCODE"/>		
		<result property="MANAGENO"					column="MANAGENO"/>
		<result property="CITYCODE"					column="CITYCODE"/>
		<result property="ADDRESS"					column="ADDRESS"/>
		<result property="CONNAME"					column="CONNAME"	/>
		<result property="CONM2"					column="CONM2"/>
		<result property="CONPY"					column="CONPY"/>
		<result property="SALEAMT"					column="SALEAMT"/>
		<result property="SALEDANGA"				column="SALEDANGA"/>
		<result property="DCGUBUN"					column="DCGUBUN"/>
		<result property="DCRATE"					column="DCRATE"/>
		<result property="DCAMT"					column="DCAMT"/>
		<result property="SELLAMT"					column="SELLAMT"/>
		<result property="SUDANGRATE"				column="SUDANGRATE"/>
		<result property="ADDRATE"					column="ADDRATE"/>
		<result property="TAXGUBUN"					column="TAXGUBUN"/>
		<result property="TAXGUBUNNAME"				column="TAXGUBUNNAME"/>
		<result property="TAXINCOME"				column="TAXINCOME"/>
		<result property="TAXLOCAL"					column="TAXLOCAL"/>
		<result property="SUPPLYTAX"				column="SUPPLYTAX"/>
		<result property="REGISTERNUM"				column="REGISTERNUM"/>
		<result property="GRADE"					column="GRADE"/>
		<result property="DUTY"						column="DUTY"/>
		<result property="REMARK"					column="REMARK"/>
		
	</resultMap>
	
	<resultMap id="EP011001DataInsertlist" class="EP011001VO">
		<result property="INSACODE"					column="INSACODE"/>
		<result property="KNAME"					column="KNAME"/>
		<result property="GRADE"					column="GRADE"/>
		<result property="DUTY"						column="DUTY"/>	
	</resultMap>
	
	<resultMap id="EP011001Datas" class="EP011001VO">
		<result property="SALEID"					column="SALEID"	/>
		<result property="PAYSEQ"					column="PAYSEQ"/>
		<result property="REGISTERSEQ"				column="REGISTERSEQ"/>		
		<result property="PAYERNAME"				column="PAYERNAME"/>
		<result property="PAYERID"					column="PAYERID"/>
		<result property="SAUPOWNER"				column="SAUPOWNER"/>
		<result property="PAYAMT"					column="PAYAMT"/>
		<result property="TAXGUBUN"					column="TAXGUBUN"/>
		<result property="TAXINCOME"				column="TAXINCOME"/>
		<result property="TAXLOCAL"					column="TAXLOCAL"/>
		<result property="SUPPLYTAX"				column="SUPPLYTAX"/>
		<result property="DEDUCTAMT"				column="DEDUCTAMT"/>
		<result property="BANKID"					column="BANKID"/>
		<result property="BANKNAME"					column="BANKNAME"/>
		<result property="ACCTNO"					column="ACCTNO"/>
		<result property="ACCTOWNER"				column="ACCTOWNER"/>
		<result property="REMARK"					column="REMARK"/>				
	</resultMap>
	
	<resultMap id="EP011001DataSaleSudang" 			class="EP011001VO">
		<result property="SALEDATE"					column="SALEDATE"/>
		<result property="SALEID"					column="SALEID"	/>
		<result property="SALERNM"					column="SALERNM"/>		
		<result property="SALEAMT"					column="SALEAMT"/>
		<result property="CONNAME"					column="CONNAME"/>
		<result property="SALEGUBUN"				column="SALEGUBUN"/>
		<result property="CONNAME"					column="CONNAME"/>
		<result property="SALERCD"					column="SALERCD"/>
		<result property="BRANCHCODE"				column="BRANCHCODE"/>
		<result property="MANAGENO"					column="MANAGENO"/>
		<result property="CITYCODE"					column="CITYCODE"/>
		<result property="ADDRESS"					column="ADDRESS"/>
		<result property="CONM2"					column="CONM2"/>
		<result property="CONPY"					column="CONPY"/>
		<result property="SALEAMT"					column="SALEAMT"/>
		<result property="SALEDANGA"				column="SALEDANGA"/>
		<result property="DCGUBUN"					column="DCGUBUN"/>
		<result property="DCRATE"					column="DCRATE"/>
		<result property="DCAMT"					column="DCAMT"/>
		<result property="SELLAMT"					column="SELLAMT"/>
	</resultMap>
	
	<resultMap id="EP011001Sheet" class="EP011001VO">
		<result property="SALEID" column="SALEID"/>
		<result property="PAYSEQ" column="PAYSEQ"/>
		<result property="INSACODE" column="INSACODE"/>
		<result property="INSANAME" column="INSANAME"/>
		<result property="BRANCHCODE" column="BRANCHCODE"/>
		<result property="BRANCHNAME" column="BRANCHNAME"/>
		<result property="ADDRESS" column="ADDRESS"/>
		<result property="CONNAME" column="CONNAME"/>
		<result property="CONPY" column="CONPY"/>
		<result property="SALEAMT" column="SALEAMT"/>
	</resultMap>

	<resultMap id="EP011001SheetList" class="EP011001VO">
		<result property="SALEID" column="SALEID"/>
		<result property="PAYSEQ" column="PAYSEQ"/>
		<result property="INSACODE" column="INSACODE"/>
		<result property="INSANAME" column="INSANAME"/>
		<result property="GRADE" column="GRADE"/>
		<result property="GRADENAME" column="GRADENAME"/>
		<result property="DUTY" column="DUTY"/>
		<result property="DUTYNAME" column="DUTYNAME"/>
		<result property="SUDANGRATE" column="SUDANGRATE"/>
		<result property="ADDRATE" column="ADDRATE"/>
		<result property="PAYAMT" column="PAYAMT"/>
		<result property="TAXGUBUN" column="TAXGUBUN"/>
		<result property="TAXGUBUNNAME" column="TAXGUBUNNAME"/>
		<result property="TAXINCOME" column="TAXINCOME"/>
		<result property="TAXLOCAL" column="TAXLOCAL"/>
		<result property="SUPPLYTAX" column="SUPPLYTAX"/>
		<result property="DEDUCTAMT" column="DEDUCTAMT"/>
		<result property="REGISTERSEQ" column="REGISTERSEQ"/>
		<result property="PAYERNAME" column="PAYERNAME"/>
		<result property="PAYERID" column="PAYERID"/>
		<result property="PAYERDEDUCTAMT" column="PAYERDEDUCTAMT"/>
		<result property="BANKID" column="BANKID"/>
		<result property="BANKNAME" column="BANKNAME"/>
		<result property="ACCTNO" column="ACCTNO"/>
		<result property="ACCTOWNER" column="ACCTOWNER"/>
	</resultMap>
	
	<resultMap id="insaMstData" class="HR011001VO">
		<result property="INSACODE" column="INSACODE"/>
		<result property="KNAME" column="KNAME"/>
		<result property="BRANCHCODE" column="BRANCHCODE"/>
		<result property="BRANCHNAME" column="BRANCHNAME"/>
		<result property="GRADE" column="GRADE"/>
		<result property="GRADENAME" column="GRADENAME"/>
		<result property="DUTY" column="DUTY"/>
		<result property="DUTYNAME" column="DUTYNAME"/>
	</resultMap>

	<select id="selectListEnaSudangMst" resultMap="EP011001Data">
	
	  SELECT T1.SALEID,
	  		 T1.PAYSEQ,
	         T1.PAYDATE,
	  		 T1.INSACODE,
	  		 (SELECT KNAME FROM hr_insamst WHERE INSACODE = T1.INSACODE) AS KNAME,
	  		 (SELECT SALERCD FROM sa_salemst WHERE SALEID = T1.SALEID) AS SALERCD,
	  		 (SELECT KNAME FROM sa_salemst S, hr_insamst I WHERE S.SALEID = T1.SALEID AND I.INSACODE = S.SALERCD) AS SALERNM,
	  		 (SELECT SELLAMT FROM sa_saledtl WHERE SALEID = T1.SALEID) AS SELLAMT,
	  		 T1.PAYAMT,
	  		 (T1.TAXINCOME + T1.TAXLOCAL + T1.SUPPLYTAX) AS TAXAMT,
	  		 T1.DEDUCTAMT,
	  		 (SELECT SALEDATE FROM sa_salemst WHERE SALEID = T1.SALEID) AS SALEDATE,	         
	         (SELECT SALEGUBUN FROM sa_salemst WHERE SALEID = T1.SALEID) AS SALEGUBUN,         
			 T1.BRANCHCODE,
			 (SELECT MANAGENO FROM mm_buymst M, sa_salemst S WHERE M.BUYID = S.BUYID AND S.SALEID = T1.SALEID) AS MANAGENO,
			 (SELECT CITYCODE FROM mm_buymst M, sa_salemst S WHERE M.BUYID = S.BUYID AND S.SALEID = T1.SALEID) AS CITYCODE,
			 (SELECT ADDRESS FROM mm_buymst M, sa_salemst S WHERE M.BUYID = S.BUYID AND S.SALEID = T1.SALEID) AS ADDRESS,
	         (SELECT CONNAME FROM sa_salemst WHERE SALEID = T1.SALEID) AS CONNAME,
			 (SELECT CONM2 FROM sa_salemst WHERE SALEID = T1.SALEID) AS CONM2,
			 (SELECT CONPY FROM sa_salemst WHERE SALEID = T1.SALEID) AS CONPY,
	         (SELECT SALEAMT FROM sa_saledtl WHERE SALEID = T1.SALEID) AS SALEAMT,
			 (SELECT SALEDANGA FROM sa_saledtl WHERE SALEID = T1.SALEID) AS SALEDANGA,
	         (SELECT DCGUBUN FROM sa_saledtl WHERE SALEID = T1.SALEID) AS DCGUBUN,
	         (SELECT DCRATE FROM sa_saledtl WHERE SALEID = T1.SALEID) AS DCRATE,
	         (SELECT DCAMT FROM sa_saledtl WHERE SALEID = T1.SALEID) AS DCAMT,
	         (SELECT SELLAMT FROM sa_saledtl WHERE SALEID = T1.SALEID) AS SELLAMT,
	         T1.SUDANGRATE,
	         T1.ADDRATE,
	         T1.TAXGUBUN,
	         (SELECT DCODENAME FROM sy_ccodedtl WHERE CCODE = '013' AND DCODE = T1.TAXGUBUN) AS TAXGUBUNNAME,
	         T1.TAXINCOME,
	         T1.TAXLOCAL,
	         T1.SUPPLYTAX,
	         T1.REMARK,
	         (SELECT IFNULL(count(T2.PAYSEQ),0) FROM sa_sudangpayertb T2 WHERE T1.SALEID = T2.SALEID AND T1.PAYSEQ = T2.PAYSEQ) AS REGISTERNUM,
	         (select DCODENAME from hr_insamst I, sy_ccodedtl C WHERE I.INSACODE = T1.INSACODE AND C.CCODE='003' AND I.GRADE = C.DCODE ) as GRADE,
	         (select DCODENAME from hr_insamst I, sy_ccodedtl C WHERE I.INSACODE = T1.INSACODE AND C.CCODE='004' AND I.DUTY = C.DCODE ) as DUTY
	    FROM sa_sudangmst T1, sa_salemst T2
	   WHERE T1.SALEID = T2.SALEID
	     AND T1.INSACODE = T2.SALERCD
<!--  		<isNotEmpty property="S_SALEID">
	 		AND T1.SALEID = #S_SALEID# 
	 		<isNotEmpty property="S_PAYSEQ">
	 			AND T1.PAYSEQ = #S_PAYSEQ# 
			</isNotEmpty>
		</isNotEmpty>
		<isEmpty property="S_SALEID">
	 			AND DATE_FORMAT(T1.PAYDATE, '%Y-%m') BETWEEN #S_SALEDATESYM# AND #S_SALEDATEEYM#
			<isNotEmpty property="S_SALERCD">
	 			AND T1.SALERCD = #S_SALERCD# 
			</isNotEmpty>
			<isNotEqual property="S_BRANCHCODE" compareValue="ALL">
	 			AND T1.BRANCHCODE = #S_BRANCHCODE# 
			</isNotEqual>
			<isNotEqual property="S_DEPTCODE" compareValue="ALL">
	 			AND T1.DEPTCODE = #S_DEPTCODE# 
			</isNotEqual>
		</isEmpty>	 -->	
		ORDER BY T1.SALEID ASC, T1.PAYSEQ
	</select>	

	<select id="selectEnaSudangMstList" resultMap="EP011001Datalist">
	
	  SELECT T1.SALEID,
	  		 T1.PAYSEQ,
	         T1.PAYDATE,
	  		 T1.INSACODE,
	  		 (SELECT KNAME FROM hr_insamst WHERE INSACODE = T1.INSACODE) AS KNAME,
	  		 (SELECT SALERCD FROM sa_salemst WHERE SALEID = T1.SALEID) AS SALERCD,
	  		 (SELECT KNAME FROM sa_salemst S, hr_insamst I WHERE S.SALEID = T1.SALEID AND I.INSACODE = S.SALERCD) AS SALERNM,
	  		 (SELECT SELLAMT FROM sa_saledtl WHERE SALEID = T1.SALEID) AS SELLAMT,
	  		 T1.PAYAMT,
	  		 T1.PAYAMT - T1.DEDUCTAMT AS TAXAMT,
	  		 T1.DEDUCTAMT,
	  		 (SELECT SALEDATE FROM sa_salemst WHERE SALEID = T1.SALEID) AS SALEDATE,	         
	         (SELECT SALEGUBUN FROM sa_salemst WHERE SALEID = T1.SALEID) AS SALEGUBUN,         
			 T1.BRANCHCODE,
			 (SELECT MANAGENO FROM mm_buymst M, sa_salemst S WHERE M.BUYID = S.BUYID AND S.SALEID = T1.SALEID) AS MANAGENO,
			 (SELECT CITYCODE FROM mm_buymst M, sa_salemst S WHERE M.BUYID = S.BUYID AND S.SALEID = T1.SALEID) AS CITYCODE,
			 (SELECT ADDRESS FROM mm_buymst M, sa_salemst S WHERE M.BUYID = S.BUYID AND S.SALEID = T1.SALEID) AS ADDRESS,
	         (SELECT CONNAME FROM sa_salemst WHERE SALEID = T1.SALEID) AS CONNAME,
			 (SELECT CONM2 FROM sa_salemst WHERE SALEID = T1.SALEID) AS CONM2,
			 (SELECT CONPY FROM sa_salemst WHERE SALEID = T1.SALEID) AS CONPY,
	         (SELECT SALEAMT FROM sa_saledtl WHERE SALEID = T1.SALEID) AS SALEAMT,
			 (SELECT SALEDANGA FROM sa_saledtl WHERE SALEID = T1.SALEID) AS SALEDANGA,
	         (SELECT DCGUBUN FROM sa_saledtl WHERE SALEID = T1.SALEID) AS DCGUBUN,
	         (SELECT DCRATE FROM sa_saledtl WHERE SALEID = T1.SALEID) AS DCRATE,
	         (SELECT DCAMT FROM sa_saledtl WHERE SALEID = T1.SALEID) AS DCAMT,
	         (SELECT SELLAMT FROM sa_saledtl WHERE SALEID = T1.SALEID) AS SELLAMT,
	         T1.SUDANGRATE,
	         T1.ADDRATE,
	         T1.TAXGUBUN,
	         (SELECT DCODENAME FROM sy_ccodedtl WHERE CCODE = '013' AND DCODE = T1.TAXGUBUN) AS TAXGUBUNNAME,
	         T1.TAXINCOME,
	         T1.TAXLOCAL,
	         T1.SUPPLYTAX,
	         T1.REMARK,
	         (SELECT IFNULL(count(T2.PAYSEQ),0) FROM sa_sudangpayertb T2 WHERE T1.SALEID = T2.SALEID AND T1.PAYSEQ = T2.PAYSEQ) AS REGISTERNUM,
	         (select DCODENAME from hr_insamst I, sy_ccodedtl C WHERE I.INSACODE = T1.INSACODE AND C.CCODE='003' AND I.GRADE = C.DCODE ) as GRADE,
	         (select DCODENAME from hr_insamst I, sy_ccodedtl C WHERE I.INSACODE = T1.INSACODE AND C.CCODE='004' AND I.DUTY = C.DCODE ) as DUTY
	    FROM sa_sudangmst T1
	   WHERE 1 = 1
	 	AND T1.SALEID = #S_SALEID# 	 	 
	 		<isEqual property="FLAG" compareValue="">
		 	AND	T1.INSACODE != #INSACODE#		      
	 		</isEqual>
		ORDER BY T1.GRADE ASC
	</select>		
	
	<select id="selectEnaSudangMstInsert" resultMap="EP011001DataInsertlist">
		
	   select	T1.INSACODE, 
	   			(select DCODENAME from sy_ccodedtl C WHERE C.CCODE='003' AND T1.GRADE = C.DCODE ) as GRADE,
	            (select DCODENAME from sy_ccodedtl C WHERE C.CCODE='004' AND T1.DUTY = C.DCODE ) as DUTY,
	            T1.KNAME	          
	  	 from   hr_insamst T1  
	 	where (T1.BRANCHCODE = (SELECT T2.BRANCHCODE 
		                  		 FROM hr_insamst T2
								WHERE T2.INSACODE = #SALERCD#
							  )
			  AND T1.DEPTCODE	= (SELECT T4.DEPTCODE 
		                  			 FROM hr_insamst T4
									WHERE T4.INSACODE = #SALERCD#
							  	   )				  
			  AND T1.GRADE = '007'
			 )
			 OR
			 (			 
			 T1.DEPTCODE = (SELECT DEPTCODE
           				      FROM ba_deptmst
           	   			     WHERE branchcode =  (SELECT T3.BRANCHCODE 
												    FROM hr_insamst T3
												   WHERE T3.INSACODE = #SALERCD#
												 ) 
				 		       AND DEPTNAME = '임원'
						   )
			 )
			 OR
			 (T1.INSACODE = (SELECT RECOID
			                   FROM hr_insamst I
							  WHERE INSACODE = #SALERCD#)
			 )	
	
	</select>
		
	<select id="selectDataEnaSudangMst" resultClass="java.lang.Integer">
		SELECT 
			COUNT(T1.INSACODE) AS CNT
		FROM sa_sudangmst T1
		WHERE 1=1
		AND T1.SALEID = #SALEID#
		AND T1.INSACODE = #INSACODE#
	</select>
	
	<select id="selectEnaSudangMstSheet" resultMap="EP011001Sheet">
		/* EP011001.selectEnaSudangMstSheet */
		SELECT A.SALEID
			, A.PAYSEQ
		    , A.INSACODE
		    , (SELECT KNAME FROM hr_insamst WHERE INSACODE = A.INSACODE) AS INSANAME
		    , A.BRANCHCODE
		    , fn_codename('02', A.BRANCHCODE, NULL) AS BRANCHNAME
		    , (SELECT ADDRESS FROM mm_buymst WHERE BUYID = B.BUYID) AS ADDRESS
		    , B.CONNAME    
		    , B.CONPY    
		    , FORMAT(C.SALEAMT, 0) AS SALEAMT
		FROM sa_sudangmst A
			INNER JOIN sa_salemst B
				ON A.SALEID = B.SALEID
			INNER JOIN sa_saledtl C
				ON A.SALEID = C.SALEID
		WHERE A.SALEID = #S_SALEID#
			AND A.PAYSEQ = #S_PAYSEQ#
	</select>

	<select id="selectEnaSudangMstSheetList" resultMap="EP011001SheetList">
		/* EP011001.selectEnaSudangMstSheetList */
		SELECT *
		FROM (
			SELECT A.SALEID
				, A.PAYSEQ
				, A.INSACODE
				, (SELECT KNAME FROM hr_insamst WHERE INSACODE = A.INSACODE) AS INSANAME
				, A.GRADE
				, fn_codename('01', '003', A.GRADE) AS GRADENAME
				, A.DUTY
				, fn_codename('01', '004', A.DUTY) AS DUTYNAME
				, A.SUDANGRATE
				, A.ADDRATE
				, FORMAT(A.PAYAMT, 0) AS PAYAMT
				, A.TAXGUBUN
				, fn_codename('01', '013', A.TAXGUBUN) AS TAXGUBUNNAME
				, FORMAT(A.TAXINCOME, 0) AS TAXINCOME
				, FORMAT(A.TAXLOCAL, 0) AS TAXLOCAL
				, FORMAT(A.SUPPLYTAX, 0) AS SUPPLYTAX
				, FORMAT(A.DEDUCTAMT, 0) AS DEDUCTAMT
				, B.REGISTERSEQ
				, IFNULL(B.PAYERNAME, '') AS PAYERNAME
				, IFNULL(fn_formatid(B.PAYERID), '') AS PAYERID
				, IFNULL(FORMAT(B.DEDUCTAMT, 0), '') AS PAYERDEDUCTAMT
				, B.BANKID
				, fn_codename('04', B.BANKID, NULL) AS BANKNAME
				, IFNULL(B.ACCTNO, '') AS ACCTNO
				, IFNULL(B.ACCTOWNER, '') AS ACCTOWNER
			FROM sa_sudangmst A
				LEFT OUTER JOIN sa_sudangpayertb B
					ON A.SALEID = B.SALEID
					AND A.PAYSEQ = B.PAYSEQ
			WHERE A.SALEID = #S_SALEID#
				AND A.INSACODE = #INSACODE#
			ORDER BY A.PAYSEQ ASC, B.REGISTERSEQ ASC
		) T
		UNION ALL
		SELECT *
		FROM (
			SELECT A.SALEID
				, A.PAYSEQ
				, A.INSACODE
				, (SELECT KNAME FROM hr_insamst WHERE INSACODE = A.INSACODE) AS INSANAME
				, A.GRADE
				, fn_codename('01', '003', A.GRADE) AS GRADENAME
				, A.DUTY
				, fn_codename('01', '004', A.DUTY) AS DUTYNAME
				, A.SUDANGRATE
				, A.ADDRATE
				, FORMAT(A.PAYAMT, 0) AS PAYAMT
				, A.TAXGUBUN
				, fn_codename('01', '013', A.TAXGUBUN) AS TAXGUBUNNAME
				, FORMAT(A.TAXINCOME, 0) AS TAXINCOME
				, FORMAT(A.TAXLOCAL, 0) AS TAXLOCAL
				, FORMAT(A.SUPPLYTAX, 0) AS SUPPLYTAX
				, FORMAT(A.DEDUCTAMT, 0) AS DEDUCTAMT
				, B.REGISTERSEQ
				, IFNULL(B.PAYERNAME, '') AS PAYERNAME
				, IFNULL(fn_formatid(B.PAYERID), '') AS PAYERID
				, IFNULL(FORMAT(B.DEDUCTAMT, 0), '') AS PAYERDEDUCTAMT
				, B.BANKID
				, fn_codename('04', B.BANKID, NULL) AS BANKNAME
				, IFNULL(B.ACCTNO, '') AS ACCTNO
				, IFNULL(B.ACCTOWNER, '') AS ACCTOWNER
			FROM sa_sudangmst A
				LEFT OUTER JOIN sa_sudangpayertb B
					ON A.SALEID = B.SALEID
					AND A.PAYSEQ = B.PAYSEQ
			WHERE A.SALEID = #S_SALEID#
				AND A.INSACODE != #INSACODE#
			ORDER BY A.GRADE ASC, A.PAYSEQ ASC, B.REGISTERSEQ ASC
		) T 		
	</select>					
		
	<insert id="insertEnaSudangMst">
		INSERT INTO sa_sudangmst
		(
			SALEID,
			PAYSEQ,
			INSACODE,
			BRANCHCODE,
			DEPTCODE,
			GRADE,
			DUTY,
			PAYDATE,
			SUDANGRATE,
			ADDRATE,
			PAYAMT,
			TAXGUBUN,
			TAXINCOME,
			TAXLOCAL,
			SUPPLYTAX,
			DEDUCTAMT,
			REMARK,
			INSERTUSER,
			INSERTDATE
		)
		VALUES(
			#SALEID#,
			(SELECT IFNULL(MAX(PAYSEQ),0) +1 FROM sa_sudangmst s WHERE SALEID = #SALEID#),
			#INSACODE#,
			(SELECT BRANCHCODE FROM hr_insamst WHERE INSACODE = #INSACODE#),
			(SELECT DEPTCODE FROM hr_insamst WHERE INSACODE = #INSACODE#),
			(SELECT GRADE FROM hr_insamst WHERE INSACODE = #INSACODE#),
			(SELECT DUTY FROM hr_insamst WHERE INSACODE = #INSACODE#),
			#PAYDATE#,
			#SUDANGRATE#,
			#ADDRATE#,
			#PAYAMT#,
			#TAXGUBUN#,
			#TAXINCOME#,
			#TAXLOCAL#,
			#SUPPLYTAX#,
			#DEDUCTAMT#,
			#REMARK#,
			#USERID#,
			SYSDATE()
		)
	</insert>	
	
	<update id="updateEnaSudangMst">
		UPDATE sa_sudangmst
		SET
			INSACODE = #INSACODE#,
			BRANCHCODE = (SELECT BRANCHCODE FROM hr_insamst WHERE INSACODE = #INSACODE#),
			DEPTCODE = (SELECT DEPTCODE FROM hr_insamst WHERE INSACODE = #INSACODE#),
			GRADE = (SELECT GRADE FROM hr_insamst WHERE INSACODE = #INSACODE#),
			DUTY = (SELECT DUTY FROM hr_insamst WHERE INSACODE = #INSACODE#),
			PAYDATE = #PAYDATE#,
			SUDANGRATE = #SUDANGRATE#,
			ADDRATE = #ADDRATE#,
			PAYAMT = #PAYAMT#,
			TAXGUBUN = #TAXGUBUN#,
			TAXINCOME = #TAXINCOME#,
			TAXLOCAL = #TAXLOCAL#,
			SUPPLYTAX = #SUPPLYTAX#,
			DEDUCTAMT = #DEDUCTAMT#,
			REMARK = #REMARK#,
			UPDATEUSER = #USERID#,
			UPDATEDATE = NOW()
		WHERE SALEID  = #SALEID#
		AND PAYSEQ = #PAYSEQ#
	</update>

	<delete id="deleteEnaSudangMst">
		DELETE FROM sa_sudangmst
		WHERE SALEID = #SALEID#
<!-- 		AND PAYSEQ = #PAYSEQ# -->
	</delete>

	<delete id="deleteEnaSudangMstPTb">
		DELETE FROM sa_sudangpayertb
		WHERE SALEID = #SALEID#
	</delete>
	
	<select id="selectListEnaSudangPTb" resultMap="EP011001Datas">
		SELECT 
			T1.SALEID,
			T1.PAYSEQ,
			T1.REGISTERSEQ,
			T1.PAYERNAME,
			case when T1.TAXGUBUN = 002
            then (
			CONCAT(SUBSTR(T1.PAYERID, 1, 3),  '-' , SUBSTR(T1.PAYERID, 4, 2),  '-' , SUBSTR(T1.PAYERID, 6, 5))
            )else(
			CONCAT(SUBSTR(T1.PAYERID, 1, 6),  '-' , SUBSTR(T1.PAYERID, 7, 13))
            )end  AS PAYERID ,
			T1.SAUPOWNER,
			T1.PAYAMT,
			(SELECT DCODENAME FROM sy_ccodedtl WHERE CCODE = '013' AND DCODE = T1.TAXGUBUN) AS TAXGUBUN,
			T1.TAXINCOME,
			T1.TAXLOCAL,
			T1.SUPPLYTAX,
			T1.DEDUCTAMT,
			(SELECT BANKNAME FROM sy_bankmst WHERE BANKCODE = T1.BANKID) AS BANKNAME,			
			T1.BANKID,			
			T1.ACCTNO,
			T1.ACCTOWNER,
			T1.REMARK
		FROM sa_sudangpayertb T1
		WHERE 1=1
 		AND T1.SALEID = #SALEID#
		AND T1.PAYSEQ = #PAYSEQ#
<!-- 		AND T1.REGISTERSEQ = #REGISTERSEQ# -->
		ORDER BY T1.REGISTERSEQ DESC
	</select>
	
	<insert id="insertEnaSudangPTb">
		INSERT INTO sa_sudangpayertb
		(
			SALEID,
			PAYSEQ,
			REGISTERSEQ,
			PAYERNAME,
			PAYERID,
			SAUPOWNER,
			PAYAMT,
			TAXGUBUN,
			TAXINCOME,
			TAXLOCAL,
			SUPPLYTAX,
			DEDUCTAMT,
			BANKID,
			ACCTNO,
			ACCTOWNER,
			REMARK,
			INSERTUSER,
			INSERTDATE
		)
		VALUES(
			#SALEID#,
			#PAYSEQ#,
			(SELECT IFNULL(MAX(REGISTERSEQ),0) +1 FROM sa_sudangpayertb s WHERE SALEID = #SALEID# AND PAYSEQ = #PAYSEQ#),
			#PAYERNAME#,
			#PAYERID#,
			#SAUPOWNER#,
			#PAYAMT#,
			#TAXGUBUN#,
			#TAXINCOME#,
			#TAXLOCAL#,
			#SUPPLYTAX#,
			#DEDUCTAMT#,
			#BANKID#,
			#ACCTNO#,
			#ACCTOWNER#,
			#REMARK#,
			#USERID#,
			SYSDATE()
		)
	</insert>	
	
	<update id="updateEnaSudangPTb">
		UPDATE sa_sudangpayertb
		SET
			PAYERNAME = #PAYERNAME#,
			PAYERID = #PAYERID#,
			SAUPOWNER = #SAUPOWNER#,
			PAYAMT = #PAYAMT#,
			TAXGUBUN = #TAXGUBUN#,
			TAXINCOME = #TAXINCOME#,
			TAXLOCAL = #TAXLOCAL#,
			SUPPLYTAX = #SUPPLYTAX#,
			DEDUCTAMT = #DEDUCTAMT#,
			BANKID = #BANKID#,
			ACCTNO = #ACCTNO#,
			ACCTOWNER = #ACCTOWNER#,
			REMARK = #REMARK#,
			UPDATEUSER = #USERID#,
			UPDATEDATE = SYSDATE()
		WHERE SALEID = #SALEID#
		AND PAYSEQ = #PAYSEQ#
		AND REGISTERSEQ = #REGISTERSEQ#
	</update>
	
	<delete id="deleteEnaSudangPTb">
		DELETE FROM sa_sudangpayertb
		WHERE SALEID = #SALEID#
		AND PAYSEQ = #PAYSEQ#
		AND REGISTERSEQ = #REGISTERSEQ#
	</delete>
		

	
	<select id="selectListEnaSaleSudangList" resultMap="EP011001DataSaleSudang">
		SELECT 
			T1.SALEDATE,
			T1.SALEID,
			(SELECT KNAME FROM hr_insamst WHERE INSACODE = T1.SALERCD) AS SALERNM,
			(SELECT SALEAMT FROM sa_saledtl WHERE SALEID = T1.SALEID) AS SALEAMT,
			T1.CONNAME,
			T1.SALEGUBUN,
			SALERCD,
			(SELECT BRANCHCODE FROM hr_insamst WHERE INSACODE = T1.SALERCD) AS BRANCHCODE,
			(SELECT MANAGENO FROM mm_buymst WHERE BUYID = T1.BUYID) AS MANAGENO,
			(SELECT CITYCODE FROM mm_buymst WHERE BUYID = T1.BUYID) AS CITYCODE,
			(SELECT ADDRESS FROM mm_buymst WHERE BUYID = T1.BUYID) AS ADDRESS,
			T1.CONNAME,
			T1.CONM2,
			T1.CONPY,
			(SELECT SALEAMT FROM sa_saledtl WHERE SALEID = T1.SALEID) AS SALEAMT,
			(SELECT SALEDANGA FROM sa_saledtl WHERE SALEID = T1.SALEID) AS SALEDANGA,
        	(SELECT DCGUBUN FROM sa_saledtl WHERE SALEID = T1.SALEID) AS DCGUBUN,
         	(SELECT DCRATE FROM sa_saledtl WHERE SALEID = T1.SALEID) AS DCRATE,
       	  	(SELECT DCAMT FROM sa_saledtl WHERE SALEID = T1.SALEID) AS DCAMT,
       	  	(SELECT SELLAMT FROM sa_saledtl WHERE SALEID = T1.SALEID) AS SELLAMT
   		FROM sa_salemst T1
		WHERE 1=1
		<isNotEmpty property="SALEID">
	 		AND T1.SALEID = #SALEID#
		</isNotEmpty>
 		<isNotEmpty property="SALEDATE">
	 		AND T1.SALEDATE = #SALEDATE# 
		</isNotEmpty>
			AND SALEID NOT IN (SELECT DISTINCT(SALEID)
		                      	 FROM sa_sudangmst)
		ORDER BY SALEID, SALEDATE
	</select>	
	
	<select id="selectListEanHRInsaMstPopup" resultMap="insaMstData">
		SELECT
			T1.INSACODE, 
			T1.KNAME, 
			T1.BRANCHCODE, 
			(SELECT IN1.BRANCHNAME FROM ba_branchmst IN1 WHERE IN1.BRANCHCODE = T1.BRANCHCODE) AS BRANCHNAME,
			GRADE, 
			fn_codename('01', '003', T1.GRADE) AS GRADENAME,
		    T1.DUTY,
		    fn_codename('01', '004', T1.DUTY) AS DUTYNAME 
		FROM hr_insamst T1
		WHERE 1=1
		<isNotEmpty property="S_KNAME">
			AND T1.KNAME LIKE '%$S_KNAME$%'
		</isNotEmpty>
   		AND T1.RETIREDATE IS NULL
   		ORDER BY T1.GRADE ASC
	</select>
	
	<select id="selectDataEnaSudangMstPTbBottom" resultClass="java.lang.Integer">
		SELECT COUNT(SALEID) AS CNT
		FROM sa_sudangpayertb
		WHERE 1 = 1
		AND SALEID = #SALEID#
		AND PAYSEQ = #PAYSEQ#
	</select>
	
	<delete id="deleteDataEnaSudangMstPTbBottom">
		DELETE FROM sa_sudangpayertb
		WHERE SALEID = #SALEID#
		AND PAYSEQ = #PAYSEQ#
	</delete>
	
	<delete id="deleteDataEnaSudangMstBottom">
		DELETE FROM sa_sudangmst
		WHERE SALEID = #SALEID#
		AND PAYSEQ = #PAYSEQ#
	</delete>
	
</sqlMap>